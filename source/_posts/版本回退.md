---

title: 版本回溯su

date: 2018-11-10 19:22:00

categories: 工具

tags: [Git]

---

---
# Review

```shell
$git add --all
$git commit -m "1st submission"
	[master f40d786] 1st submission
	 X file changed, Y insertations(+)
 	 create mode ......	
 
```

[roadMap](https://sp18.datastructur.es/materials/guides/img/file-status.png)

https://sp18.datastructur.es/materials/guides/using-git.html


---
# 版本回溯


---
## 查看版本历史纪录

`git log`

```shell
$ git log
commit 1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -> master)
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 21:06:15 2018 +0800

    append GPL

commit e475afc93c209a690c39c13a46716e8fa000c366
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 21:03:36 2018 +0800

    add distributed

commit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0
Author: Michael Liao <askxuefeng@gmail.com>
Date:   Fri May 18 20:59:18 2018 +0800

    wrote a readme files
```


---
### 输出单行简略版log历史纪录

`git log --pretty=oneline`

```shell
42288d4662fbe775395584c925f55278fb7589be (HEAD -> master, origin/master, origin/HEAD) 2rd submission of IntList, modify the null arguments conditiojns
f40d7867ffa9582c6422d3ac1e7fd90bfca50153 add explanaition
916759da166972de1a4d0ffa608414be529b01b0 1st submission of Debug Practice Lab2
c89245fb5c9e66e3830456c18d606bcc4f58d8f0 1st submission of lab2

```


---
## 回退到具体的一个版本

---
### 版本信息`commit id` `HEAD`

如上文，类似`42288d4662fbe775395584c925f55278fb7589be` `f40d7867ffa9582c6422d3ac1e7fd90bfca50153` 是`commit id` 

在`Git`中，`HEAD`表示的是 当前最新的版本 - 上文中就是，***42288d4662fbe775395584c925f55278fb7589be** (HEAD -> master, origin/master, origin/HEAD) 2rd submission of IntList, modify the null arguments conditiojns*

前一个版本可以表示为`^HEAD`,再往前面一个版本为`^^HEAD`

 回溯100个版本可以表示为`HEAD~100`

**Hint `git log -n` 可以控制输出log的条数，输出最近n条log**

---
### 回溯 `git reset`

`git ret` 命令用于指定回退到某一版本

```shell
$git reset --hard  HEAD^
$git log -3
f40d7867ffa9582c6422d3ac1e7fd90bfca50153 (HEAD -> master) add explanaition
916759da166972de1a4d0ffa608414be529b01b0 1st submission of Debug Practice Lab2
c89245fb5c9e66e3830456c18d606bcc4f58d8f0 1st submission of lab2

```
再使用`log`查看`commit id`记录
```shell
$ git log -3 --pretty=oneline
f40d7867ffa9582c6422d3ac1e7fd90bfca50153 (HEAD -> master) add explanaition
916759da166972de1a4d0ffa608414be529b01b0 1st submission of Debug Practice Lab2
c89245fb5c9e66e3830456c18d606bcc4f58d8f0 1st submission of lab2
```
会发现`HEAD`指针，指向了`commmit id`为`f40d...`的版本


(--hard 执行细节另述)

---
#### 回溯到回溯之前的`commit id`

在shell / cmd 没有关掉时，可以再输入回溯之前的`commit id`来回到之前的版本(可以通过`git reflog`查看之前的`HEAD`指向情况)

```shell
$git reset --hard 42288d
$git log -5 --pretty=onelien
42288d4662fbe775395584c925f55278fb7589be (HEAD -> master, origin/master, origin/HEAD) 2rd submission of IntList, modify the null arguments conditiojns
f40d7867ffa9582c6422d3ac1e7fd90bfca50153 add explanaition
916759da166972de1a4d0ffa608414be529b01b0 1st submission of Debug Practice Lab2
c89245fb5c9e66e3830456c18d606bcc4f58d8f0 1st submission of lab2
1da7660846aa5a226e130d4b26074d63eaa7ea40 proj 0 2rd try
```

实际上不用写全`commit id`，只要写一些部分，`git`会进行自动查找，并执行命令


---
## 回溯简单原理

`Git` 内部有指向当前版本的`HEAD`指针，`reset` 命令让`Git`中`HEAD`指针进行切换，指向特定的版本号
*当前版本*
[now](https://www.fcwalkers.com/2018/03/29/GIT/GIT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/QQ20171117-112922@2x.png)
*回溯到之前版本*
[reset](https://www.fcwalkers.com/2018/03/29/GIT/GIT%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/QQ20171117-112940@2x.png)


### `reflog`记录每一次命令

相对于记录`commit id`的`log`，`relog`帮助记录每一个命令，以及操作的`HEAD`指向对象

```shell
$ git reflog -5 --pretty=oneline
42288d4 (HEAD -> master, origin/master, origin/HEAD) HEAD@{0}: reset: moving to42288d
f40d786 HEAD@{1}: reset: moving to HEAD^
42288d4 (HEAD -> master, origin/master, origin/HEAD) HEAD@{2}: commit: 2rd submission of IntList, modify the null arguments conditiojns
f40d786 HEAD@{3}: commit: add explanaition
916759d HEAD@{4}: commit: 1st submission of Debug Practice Lab2

```

