---
title: 变量作用域与解构赋值
date: 2018-09-19 20:06:00
tags: [JavaScript, Font-end]
categories: 网络编程
---

---
## `var`声明的变量具有作用域
`'strict'`模式中，`var`定义的变量作用域为整个函数体，在函数体外不可引用该变量。 不同函数内部的同名变量相互独立，互不影响。

**函数嵌套中** 内部函数可以访问外部函数定义的变量，反过来不行
如果**内部函数和外部函数变量重名**，以内部函数变量优先调用 - 内部函数的变量将“屏蔽”外部函数的变量（这两条性值和python类似）

---
## 优先确定变量 - 变量提升

`JavaScript`的函数定义有个特点，它会先扫描整个函数体的语句，把所有申明的变量“提升”到函数顶部 - 可以时候后定义的变量

因而最好**在函数内部首先申明所有变量**


---
## 全局作用域
不在任何函数内定义的变量就具有全局作用域。实际上，JavaScript默认有一个全局对象`window`，全局作用域的变量实际上被绑定到`window`的一个属性
```javascript
var course = 'Learn JavaScript';
console.log(course);
console.log(window.course);
```
函数也是window的一个变量
JavaScript实际上只有一个全局作用域。任何变量（函数也视为变量），如果没有在当前函数作用域中找到，就会继续往上查找，最后如果在全局作用域中也没有找到，则报`ReferenceError`错误（和python类似）


---
## 创建命名空间

全局变量会绑定到window上，不同的JavaScript文件如果使用了相同的全局变量，或者定义了相同名字的顶层函数，都会造成命名冲突，并且很难被发现
减少冲突的一个方法是把自己的所有变量和函数**全部绑定到一个全局变量**中
```javascript
var MYAPP = {};

MYAPP.variable1 = 1;
MYAPP.version = 1.0;
MYAPP.foo = function () {
    return 'foo';
MYAPP.version = 1.1;
};
```

---
## 局部作用域 let
Javascript作用域是在函数内部，无法定义出 - 例如只在for循环中局部定义的 - 变量
```javascript
function foo() {
    for (var i=0; i < 100; i ++) {
        //
    }
    i += 100; //可以使用变量 i
}
```
ES6中引入关键字let,只作用于<abbr title="块作用域由 { } 包括">块级作用域</abbr>
```javascript
function foo() {
    var sum = 0;
    for (let i = 0; i <k 100; i++) {
        sum += i;
    }
    i += 1;   //Raise SyntaxError
}
```

---
## 常量
ES6 之前，`var`中定义的变量名为**大写** 来表示常量，ES6中，引用新的关键词`const`来定义常量，`const`和`let`都有块级作用域
```javascript
const PI = 3.14;
PI = 3;
PI; //3.14
```

---
## 解构赋值 
对数组元素进行解构赋值时，多个变量要用`[...]`括起来
注意**嵌套层次**和**位置**需要保持一致
```javascript
let [x, [y, z]] = ['hello', ['JavaScript', 'ES6']]
```
### 结构赋值可以忽略某些元素
直接忽略前置的元素
```
let [, , z] = ['hello', 'JavaScript', 'ES6'];
z; // ES6
```
如果需要从一个**对象**中取出若干属性，也可以使用解构赋值，便于快速获取对象的指定属性
```
'use strict';

var person = {
    name: '小明',
    age: 20,
    gender: 'male',
    passport: 'G-12345678',
    school: 'No.4 middle school'
};
var {name, age, passport} = person;
```
### 嵌套对象解构赋值
如有嵌套对象，也可以直接对**嵌套的对象属性进行赋值**，只要保证对应的层次是一致的
```javascript
var person = {
    name: '小明',
    age: 20,
    gender: 'male',
    school: 'YG',
    address: {
        city: 'Zhejiang Province',
        street: 'Century Road',
        zipcode: '3111100'
    }
};
var {name, adrress: {city, zip}}=person;
name; //'小明'
city;    //'Zhejiang Province'
zip;     //undefined 因为属性名是zipcode不是zip
```
使用解构赋值对对象属性进行赋值时，如果对应的属性不存在，变量将被赋值为undefined，这和引用一个不存在的属性获得undefined是一致的


### 属性直接赋值给另外一个变量
如果要使用的变量名和属性名不一致可以在属性名后直接加上要赋值的变量名
```javascript
var person = {
    name: '小明',
    age: 20,
    gender: 'male',
    passport: 'G-12345678',
    school: 'No.4 middle school'
};

// 把passport属性赋值给变量id:
let {name, passport:id} = person;
```

### 默认值
解构赋值可以使用默认值，来避免返回undefined的情况
```javascript
var {name, single=true} = person;
```
### 已声明的变量在解构中会报错
```javascript
var x, y;
// 解构赋值:
{x, y} = { name: '小明', x: 100, y: 200};
// 语法错误: Uncaught SyntaxError: Unexpected token =
```
### 使用场景
**swap**
```javascriot
var x=1, y=2;
[x, y] = [y, x]
```
快速获取域名，路径
```javascript
var {hostname:domain, pathname:path} = location;
```
**解构赋值可以减少代码量**，但是，需要在支持ES6解构赋值特性的现代浏览器中才能正常运行。目前支持解构赋值的浏览器包括Chrome，Firefox，Edge等